CREATE TABLE main.users (
	"Id" uuid NOT NULL,
	"FirstName" text NULL,
	"SecondName" text NULL,
	"Role" int4 NOT NULL,
	"Account" uuid NOT NULL,
	"Email" varchar(256) NULL,
	CONSTRAINT "PK_users" PRIMARY KEY ("Id")
);
CREATE INDEX "EmailIndex" ON main.users USING btree ("Email");



CREATE TABLE main.events (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"Name" varchar(50) NOT NULL,
	"Description" text NULL,
	"Price" float4 NOT NULL,
	"Address" varchar(100) NOT NULL,
	"Type" int4 NOT NULL,
	"Rating" float4 NOT NULL,
	"AdminId" uuid NOT NULL,
	"Uid" uuid NOT NULL,
	CONSTRAINT "PK_events" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_events_AdminId" ON main.events USING btree ("AdminId");
CREATE UNIQUE INDEX "IX_events_Uid" ON main.events USING btree ("Uid");

ALTER TABLE main.events ADD CONSTRAINT "FK_events_users_AdminId" FOREIGN KEY ("AdminId") REFERENCES main.users("Id") ON DELETE CASCADE;



CREATE TABLE main.specific_events (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"EventId" int4 NOT NULL,
	"Description" text NULL,
	"TicketCount" int4 NOT NULL,
	"Price" float4 NOT NULL,
	"Address" text NULL,
	"Date" date NULL,
	"DayOfWeek" int4 NULL,
	"Time" time NOT NULL,
	"Private" bool NOT NULL,
	"Code" varchar(50) NOT NULL,
	"Rating" float4 NOT NULL,
	"Uid" uuid NOT NULL,
	CONSTRAINT "PK_specific_events" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_specific_events_EventId" ON main.specific_events USING btree ("EventId");
CREATE UNIQUE INDEX "IX_specific_events_Uid" ON main.specific_events USING btree ("Uid");

ALTER TABLE main.specific_events ADD CONSTRAINT "FK_specific_events_events_EventId" FOREIGN KEY ("EventId") REFERENCES main.events("Id") ON DELETE CASCADE;



CREATE TABLE main.event_tickets (
	"Id" int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"UserId" uuid NOT NULL,
	"SpecificEventId" int4 NOT NULL,
	"Status" int4 NOT NULL,
	"Feedback" text NULL,
	"Rating" float8 NOT NULL,
	"Uid" uuid NOT NULL,
	CONSTRAINT "PK_event_tickets" PRIMARY KEY ("Id")
);
CREATE INDEX "IX_event_tickets_SpecificEventId" ON main.event_tickets USING btree ("SpecificEventId");
CREATE UNIQUE INDEX "IX_event_tickets_Uid" ON main.event_tickets USING btree ("Uid");
CREATE INDEX "IX_event_tickets_UserId" ON main.event_tickets USING btree ("UserId");

ALTER TABLE main.event_tickets ADD CONSTRAINT "FK_event_tickets_specific_events_SpecificEventId" FOREIGN KEY ("SpecificEventId") REFERENCES main.specific_events("Id") ON DELETE CASCADE;
ALTER TABLE main.event_tickets ADD CONSTRAINT "FK_event_tickets_users_UserId" FOREIGN KEY ("UserId") REFERENCES main.users("Id") ON DELETE CASCADE;